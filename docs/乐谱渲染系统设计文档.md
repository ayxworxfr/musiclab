# ä¹è°±æ¸²æŸ“ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

> ä¹ç†é€š - ä¸“ä¸šçº§ä¹è°±æ¸²æŸ“å¼•æ“æŠ€æœ¯æ–¹æ¡ˆ
> 
> ç‰ˆæœ¬: v2.0
> 
> ä½œè€…: MusicLab Team
> 
> æ›´æ–°æ—¥æœŸ: 2026-01-13

---

## ç›®å½•

1. [æ¦‚è¿°](#1-æ¦‚è¿°)
2. [æŠ€æœ¯é€‰å‹](#2-æŠ€æœ¯é€‰å‹)
3. [æ•´ä½“æ¶æ„](#3-æ•´ä½“æ¶æ„)
4. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#4-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
5. [äº”çº¿è°±æ¸²æŸ“](#5-äº”çº¿è°±æ¸²æŸ“)
6. [ç®€è°±æ¸²æŸ“](#6-ç®€è°±æ¸²æŸ“)
7. [åŒè°±è”åŠ¨](#7-åŒè°±è”åŠ¨)
8. [äº¤äº’ç³»ç»Ÿ](#8-äº¤äº’ç³»ç»Ÿ)
9. [æ€§èƒ½ä¼˜åŒ–](#9-æ€§èƒ½ä¼˜åŒ–)
10. [å®æ–½è®¡åˆ’](#10-å®æ–½è®¡åˆ’)

---

## 1. æ¦‚è¿°

### 1.1 èƒŒæ™¯

ä¹è°±æ¸²æŸ“æ˜¯éŸ³ä¹æ•™è‚²è½¯ä»¶çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œéœ€è¦åŒæ—¶æ»¡è¶³ï¼š
- **ç²¾ç¡®æ€§**ï¼šçº¿æ¡ç²—ç»†ã€éŸ³ç¬¦é—´è·å¿…é¡»ç²¾ç¡®æ§åˆ¶
- **ä¸“ä¸šæ€§**ï¼šç¬¦åˆæ ‡å‡†çš„éŸ³ä¹è®°è°±è§„èŒƒ
- **æ€§èƒ½**ï¼šæµç•…çš„æ»šåŠ¨ã€ç¼©æ”¾ã€æ’­æ”¾åŒæ­¥
- **äº¤äº’æ€§**ï¼šç‚¹å‡»ã€ç¼–è¾‘ã€é«˜äº®æ˜¾ç¤º

### 1.2 ç°çŠ¶é—®é¢˜

| é—®é¢˜ | å½±å“ | æ ¹å›  |
|------|------|------|
| ç®€è°±å»¶éŸ³çº¿ä½ç½®é”™ä¹± | è§†è§‰æ··ä¹± | Widget æ‹¼æ¥å¸ƒå±€é™åˆ¶ |
| äº”çº¿è°±éŸ³ç¬¦ä¸è¿çº¿ | ä¸ä¸“ä¸š | ç¼ºå°‘ç¬¦æ åˆ†ç»„ç®—æ³• |
| ç¼ºå°‘è¿éŸ³çº¿ | åŠŸèƒ½ç¼ºå¤± | æ— è·¨éŸ³ç¬¦ç»˜åˆ¶èƒ½åŠ› |
| ç¬¦å·ä¸ç»Ÿä¸€ | è§†è§‰å·® | ä½¿ç”¨ç³»ç»Ÿå­—ä½“ |

### 1.3 ç›®æ ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¸²æŸ“è´¨é‡ç›®æ ‡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â­â­â­â­â­  ä¸“ä¸šçº§äº”çº¿è°±æ¸²æŸ“ï¼ˆç¬¦æ ã€è¿éŸ³çº¿ã€åŠ›åº¦è®°å·ï¼‰           â”‚
â”‚  â­â­â­â­â­  æ ‡å‡†ç®€è°±æ¸²æŸ“ï¼ˆé«˜ä½éŸ³ç‚¹ã€ä¸‹åˆ’çº¿ã€å»¶éŸ³çº¿ç²¾ç¡®å¯¹é½ï¼‰      â”‚
â”‚  â­â­â­â­    SMuFL æ ‡å‡†éŸ³ä¹ç¬¦å·                                  â”‚
â”‚  â­â­â­â­    æµç•…çš„ 60fps æ¸²æŸ“æ€§èƒ½                               â”‚
â”‚  â­â­â­â­    å®Œå–„çš„ç‚¹å‡»ã€é€‰æ‹©ã€ç¼–è¾‘äº¤äº’                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 æ¸²æŸ“æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ç²¾ç¡®æ§åˆ¶ | å¤æ‚å›¾å½¢ | æ€§èƒ½ | è·¨å¹³å° | é€‰æ‹© |
|------|---------|---------|------|--------|------|
| **Canvas (CustomPainter)** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | âœ… **é‡‡ç”¨** |
| Widget ç»„åˆ | â­â­ | â­ | â­â­ | â­â­â­â­â­ | âŒ |
| SVG | â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ | âŒ |
| WebGL | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­ | âŒ |

### 2.2 å­—ä½“æ–¹æ¡ˆ

| æ–¹æ¡ˆ | ä¸“ä¸šåº¦ | å…¼å®¹æ€§ | æ–‡ä»¶å¤§å° | é€‰æ‹© |
|------|--------|--------|---------|------|
| **SMuFL (Bravura)** | â­â­â­â­â­ | â­â­â­â­ | ~400KB | âœ… **é‡‡ç”¨** |
| Unicode éŸ³ä¹ç¬¦å· | â­â­â­ | â­â­â­â­â­ | 0 | å¤‡é€‰ |
| çº¯è‡ªç»˜ | â­â­â­â­ | â­â­â­â­â­ | 0 | å¤‡é€‰ |

### 2.3 SMuFL å­—ä½“è¯´æ˜

**SMuFL (Standard Music Font Layout)** æ˜¯ W3C åˆ¶å®šçš„éŸ³ä¹å­—ä½“æ ‡å‡†ã€‚

```
SMuFL ä¼˜åŠ¿ï¼š
â”œâ”€â”€ æ ‡å‡†åŒ–çš„éŸ³ç¬¦ã€ä¼‘æ­¢ç¬¦ã€è°±å·
â”œâ”€â”€ ç²¾ç¡®çš„åŸºçº¿å¯¹é½
â”œâ”€â”€ ä¸°å¯Œçš„åŠ›åº¦ã€è¡¨æƒ…è®°å·
â”œâ”€â”€ ä¸“ä¸šæ’ç‰ˆè½¯ä»¶éƒ½åœ¨ç”¨ï¼ˆMuseScore, Doricoï¼‰
â””â”€â”€ å¼€æºå­—ä½“ Bravura å…è´¹ä½¿ç”¨
```

**ä¸»è¦ç¬¦å·ç ç‚¹ç¤ºä¾‹ï¼š**

| ç¬¦å· | åç§° | Unicode | SMuFL åç§° |
|------|------|---------|-----------|
| ğ„ | é«˜éŸ³è°±å· | U+1D11E | gClef |
| ğ„¢ | ä½éŸ³è°±å· | U+1D122 | fClef |
| ğ… | å…¨éŸ³ç¬¦ | U+1D15D | noteWhole |
| ğ…—ğ…¥ | äºŒåˆ†éŸ³ç¬¦ | U+1D15E | noteHalfUp |
| â™© | å››åˆ†éŸ³ç¬¦ | U+2669 | noteQuarterUp |
| â™¯ | å‡å· | U+266F | accidentalSharp |
| â™­ | é™å· | U+266D | accidentalFlat |

---

## 3. æ•´ä½“æ¶æ„

### 3.1 åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           è¡¨ç°å±‚ (Widgets)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚SheetCanvasViewâ”‚  â”‚InteractiveSheetâ”‚  â”‚SheetWithPianoWidget â”‚    â”‚
â”‚  â”‚  (å®¹å™¨ç»„ä»¶)    â”‚  â”‚  (äº¤äº’åŒ…è£…)    â”‚  â”‚   (é’¢ç´è”åŠ¨)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           æ¸²æŸ“å±‚ (Painters)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ StaffPainter  â”‚  â”‚ JianpuPainter â”‚  â”‚    DualPainter        â”‚    â”‚
â”‚  â”‚  (äº”çº¿è°±)     â”‚  â”‚   (ç®€è°±)      â”‚  â”‚     (åŒè°±)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    BaseNotationPainter                        â”‚   â”‚
â”‚  â”‚  â€¢ å…±äº«ç»˜å›¾å·¥å…·ï¼ˆæ–‡å­—ã€çº¿æ¡ã€æ›²çº¿ï¼‰                            â”‚   â”‚
â”‚  â”‚  â€¢ SMuFL ç¬¦å·ç»˜åˆ¶                                             â”‚   â”‚
â”‚  â”‚  â€¢ é¢œè‰²ã€æ ·å¼ç®¡ç†                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           å¸ƒå±€å±‚ (Layout Engine)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚MeasureLayout â”‚  â”‚BeamCalculatorâ”‚  â”‚ TieCalculatorâ”‚              â”‚
â”‚  â”‚ (å°èŠ‚å¸ƒå±€)   â”‚  â”‚  (ç¬¦æ åˆ†ç»„)  â”‚  â”‚  (è¿éŸ³çº¿)   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ NoteSpacing  â”‚  â”‚ LineBreaker  â”‚  â”‚ LyricAligner â”‚              â”‚
â”‚  â”‚ (éŸ³ç¬¦é—´è·)   â”‚  â”‚  (æ¢è¡Œç®—æ³•)  â”‚  â”‚  (æ­Œè¯å¯¹é½)  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           æ•°æ®å±‚ (Models)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SheetModel, SheetMeasure, SheetNote, NoteLayout, BeamGroup  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç›®å½•ç»“æ„

```
lib/features/tools/sheet_music/
â”œâ”€â”€ painters/                          # æ¸²æŸ“å±‚
â”‚   â”œâ”€â”€ base_notation_painter.dart     # åŸºç¡€æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ staff_painter.dart             # äº”çº¿è°±æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ jianpu_painter.dart            # ç®€è°±æ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ dual_painter.dart              # åŒè°±æ¸²æŸ“å™¨
â”‚   â””â”€â”€ music_symbols.dart             # SMuFL ç¬¦å·å®šä¹‰
â”‚
â”œâ”€â”€ layout/                            # å¸ƒå±€å¼•æ“
â”‚   â”œâ”€â”€ notation_layout.dart           # å¸ƒå±€æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ measure_layout_engine.dart     # å°èŠ‚å¸ƒå±€è®¡ç®—
â”‚   â”œâ”€â”€ beam_calculator.dart           # ç¬¦æ åˆ†ç»„ç®—æ³•
â”‚   â”œâ”€â”€ tie_calculator.dart            # è¿éŸ³çº¿è®¡ç®—
â”‚   â”œâ”€â”€ note_spacing.dart              # éŸ³ç¬¦é—´è·ç®—æ³•
â”‚   â””â”€â”€ line_breaker.dart              # æ¢è¡Œç®—æ³•
â”‚
â”œâ”€â”€ widgets/                           # è¡¨ç°å±‚
â”‚   â”œâ”€â”€ sheet_canvas_widget.dart       # Canvas å®¹å™¨
â”‚   â”œâ”€â”€ interactive_sheet_widget.dart  # äº¤äº’å±‚
â”‚   â”œâ”€â”€ sheet_with_piano_widget.dart   # é’¢ç´è”åŠ¨
â”‚   â””â”€â”€ notation_mode_switcher.dart    # è®°è°±æ³•åˆ‡æ¢
â”‚
â”œâ”€â”€ models/                            # æ•°æ®å±‚
â”‚   â””â”€â”€ sheet_model.dart               # ä¹è°±æ•°æ®æ¨¡å‹
â”‚
â”œâ”€â”€ controllers/                       # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ sheet_player_controller.dart   # æ’­æ”¾æ§åˆ¶
â”‚   â””â”€â”€ sheet_editor_controller.dart   # ç¼–è¾‘æ§åˆ¶
â”‚
â””â”€â”€ services/                          # æœåŠ¡
    â””â”€â”€ sheet_import_service.dart      # å¯¼å…¥æœåŠ¡
```

### 3.3 æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SheetModel  â”‚ â”€â”€â–¶ â”‚ LayoutEngine â”‚ â”€â”€â–¶ â”‚  Painter     â”‚
â”‚  (åŸå§‹æ•°æ®)   â”‚     â”‚  (å¸ƒå±€è®¡ç®—)   â”‚     â”‚  (Canvasç»˜åˆ¶) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                    â”‚
       â”‚                    â”‚                    â”‚
       â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ç»“æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SheetModel                                          â”‚
â”‚  â””â”€ measures: List<SheetMeasure>                     â”‚
â”‚       â””â”€ notes: List<SheetNote>                      â”‚
â”‚            â””â”€ degree, octave, duration, lyric...     â”‚
â”‚                                                      â”‚
â”‚  LayoutResult                                        â”‚
â”‚  â””â”€ lines: List<LineLayout>                          â”‚
â”‚       â””â”€ measures: List<MeasureLayout>               â”‚
â”‚            â””â”€ notes: List<NoteLayout>                â”‚
â”‚                 â””â”€ x, y, beamGroup, stemDirection    â”‚
â”‚            â””â”€ beamGroups: List<BeamGroup>            â”‚
â”‚            â””â”€ ties: List<TieConnection>              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 4.1 å¸ƒå±€æ•°æ®ç»“æ„

```dart
/// éŸ³ç¬¦å¸ƒå±€ä¿¡æ¯
class NoteLayout {
  final int measureIndex;      // æ‰€å±å°èŠ‚
  final int noteIndex;         // éŸ³ç¬¦ç´¢å¼•
  final SheetNote note;        // åŸå§‹æ•°æ®
  
  final double x;              // X åæ ‡
  final double y;              // Y åæ ‡ (äº”çº¿è°±) / åŸºçº¿ (ç®€è°±)
  
  final int staffPosition;     // äº”çº¿è°±ä½ç½® (0=E4)
  final bool stemUp;           // ç¬¦å¹²æ–¹å‘
  final int beamGroupIndex;    // ç¬¦æ ç»„ç´¢å¼• (-1=æ— )
  
  final Rect hitBox;           // ç‚¹å‡»åŒºåŸŸ
}

/// ç¬¦æ ç»„ï¼ˆè¿æ¥å¤šä¸ªéŸ³ç¬¦çš„æ¨ªæ ï¼‰
class BeamGroup {
  final List<int> noteIndices; // ç»„å†…éŸ³ç¬¦ç´¢å¼•
  final int beamCount;         // ç¬¦æ æ•°é‡ (1=å…«åˆ†, 2=åå…­åˆ†)
  final bool stemUp;           // ç»Ÿä¸€ç¬¦å¹²æ–¹å‘
  final double startX, endX;   // ç¬¦æ èµ·æ­¢X
  final double startY, endY;   // ç¬¦æ èµ·æ­¢Yï¼ˆè€ƒè™‘æ–œç‡ï¼‰
}

/// è¿éŸ³çº¿ï¼ˆTie/Slurï¼‰
class TieConnection {
  final int startMeasure, startNote;
  final int endMeasure, endNote;
  final Offset startPoint;
  final Offset endPoint;
  final Offset controlPoint1;  // è´å¡å°”æ§åˆ¶ç‚¹
  final Offset controlPoint2;
  final bool isTie;            // true=åŒéŸ³è¿æ¥, false=åœ†æ»‘çº¿
}

/// å°èŠ‚å¸ƒå±€
class MeasureLayout {
  final int measureIndex;
  final double startX;
  final double width;
  final List<NoteLayout> notes;
  final List<BeamGroup> beamGroups;
}

/// è¡Œå¸ƒå±€
class LineLayout {
  final int lineIndex;
  final double startY;
  final double height;
  final List<MeasureLayout> measures;
  final bool showClef;         // æ˜¯å¦æ˜¾ç¤ºè°±å·
  final bool showKeySignature; // æ˜¯å¦æ˜¾ç¤ºè°ƒå·
  final bool showTimeSignature;// æ˜¯å¦æ˜¾ç¤ºæ‹å·
}
```

### 4.2 å¸ƒå±€å¼•æ“

```dart
/// å¸ƒå±€å¼•æ“ - è®¡ç®—æ‰€æœ‰å…ƒç´ çš„ç²¾ç¡®ä½ç½®
class NotationLayoutEngine {
  
  /// è®¡ç®—å®Œæ•´å¸ƒå±€
  static LayoutResult calculate({
    required SheetModel sheet,
    required double availableWidth,
    required NotationConfig config,
  }) {
    final lines = <LineLayout>[];
    var currentY = _calculateHeaderHeight(sheet, config);
    
    // 1. æ¢è¡Œåˆ†ç»„
    final lineGroups = _breakIntoLines(sheet.measures, availableWidth, config);
    
    // 2. è®¡ç®—æ¯è¡Œå¸ƒå±€
    for (var i = 0; i < lineGroups.length; i++) {
      final measureIndices = lineGroups[i];
      final isFirstLine = (i == 0);
      
      // è®¡ç®—è¡Œå†…å°èŠ‚å¸ƒå±€
      final measures = _layoutMeasures(
        sheet, measureIndices, availableWidth, currentY, isFirstLine, config,
      );
      
      // è®¡ç®—ç¬¦æ åˆ†ç»„
      for (final measure in measures) {
        measure.beamGroups = BeamCalculator.calculate(
          measure.notes,
          sheet.metadata.timeSignature,
          config,
        );
        _assignBeamGroups(measure);
      }
      
      lines.add(LineLayout(
        lineIndex: i,
        startY: currentY,
        height: config.lineHeight,
        measures: measures,
        showClef: isFirstLine,
        showKeySignature: isFirstLine,
        showTimeSignature: isFirstLine,
      ));
      
      currentY += config.lineHeight;
    }
    
    // 3. è®¡ç®—è¿éŸ³çº¿
    final ties = TieCalculator.findAll(lines);
    
    return LayoutResult(
      lines: lines,
      ties: ties,
      totalHeight: currentY,
    );
  }
}
```

### 4.3 ç¬¦æ åˆ†ç»„ç®—æ³•

```dart
/// ç¬¦æ åˆ†ç»„è®¡ç®—å™¨
class BeamCalculator {
  
  /// è®¡ç®—å°èŠ‚å†…çš„ç¬¦æ åˆ†ç»„
  static List<BeamGroup> calculate(
    List<NoteLayout> notes,
    String timeSignature,
    NotationConfig config,
  ) {
    final groups = <BeamGroup>[];
    var currentGroup = <int>[];
    var beatAccumulator = 0.0;
    
    for (var i = 0; i < notes.length; i++) {
      final note = notes[i].note;
      final beamCount = note.duration.underlineCount;
      
      // è§„åˆ™1: ä¼‘æ­¢ç¬¦æˆ–é•¿éŸ³ç¬¦æ‰“æ–­åˆ†ç»„
      if (note.isRest || beamCount == 0) {
        _finalizeGroup(groups, notes, currentGroup, config);
        currentGroup = [];
        beatAccumulator = 0;
        continue;
      }
      
      // è§„åˆ™2: æ•´æ‹å¤„æ–­å¼€
      if (beatAccumulator >= 1.0 && currentGroup.isNotEmpty) {
        _finalizeGroup(groups, notes, currentGroup, config);
        currentGroup = [];
        beatAccumulator = 0;
      }
      
      // åŠ å…¥å½“å‰ç»„
      currentGroup.add(i);
      beatAccumulator += note.actualBeats;
    }
    
    // å¤„ç†æœ€åä¸€ç»„
    _finalizeGroup(groups, notes, currentGroup, config);
    
    return groups;
  }
  
  static void _finalizeGroup(
    List<BeamGroup> groups,
    List<NoteLayout> notes,
    List<int> indices,
    NotationConfig config,
  ) {
    if (indices.length < 2) return; // å•éŸ³ç¬¦ä¸éœ€è¦ç¬¦æ 
    
    // ç¡®å®šç¬¦å¹²æ–¹å‘ï¼ˆæ ¹æ®å¹³å‡ä½ç½®ï¼‰
    final avgPosition = indices
        .map((i) => notes[i].staffPosition)
        .reduce((a, b) => a + b) / indices.length;
    final stemUp = avgPosition < 4; // ç¬¬ä¸‰çº¿ä»¥ä¸‹å‘ä¸Š
    
    // è®¡ç®—ç¬¦æ æ•°é‡ï¼ˆå–ç»„å†…æœ€å°å€¼ï¼‰
    final beamCount = indices
        .map((i) => notes[i].note.duration.underlineCount)
        .reduce((a, b) => a < b ? a : b);
    
    // è®¡ç®—ç¬¦æ ä½ç½®
    final firstNote = notes[indices.first];
    final lastNote = notes[indices.last];
    final stemLength = config.lineSpacing * 3.5;
    
    groups.add(BeamGroup(
      noteIndices: List.from(indices),
      beamCount: beamCount,
      stemUp: stemUp,
      startX: firstNote.x,
      endX: lastNote.x,
      startY: stemUp ? firstNote.y - stemLength : firstNote.y + stemLength,
      endY: stemUp ? lastNote.y - stemLength : lastNote.y + stemLength,
    ));
  }
}
```

### 4.4 è¿éŸ³çº¿è®¡ç®—

```dart
/// è¿éŸ³çº¿è®¡ç®—å™¨
class TieCalculator {
  
  /// æŸ¥æ‰¾æ‰€æœ‰è¿éŸ³çº¿
  static List<TieConnection> findAll(List<LineLayout> lines) {
    final connections = <TieConnection>[];
    
    // æ‰å¹³åŒ–æ‰€æœ‰éŸ³ç¬¦
    final allNotes = <(int, int, NoteLayout)>[]; // (measureIndex, noteIndex, layout)
    for (final line in lines) {
      for (final measure in line.measures) {
        for (final note in measure.notes) {
          allNotes.add((note.measureIndex, note.noteIndex, note));
        }
      }
    }
    
    // æŸ¥æ‰¾ tieStart æ ‡è®°çš„éŸ³ç¬¦
    for (var i = 0; i < allNotes.length; i++) {
      final (mi, ni, noteLayout) = allNotes[i];
      if (!noteLayout.note.tieStart) continue;
      
      // æŸ¥æ‰¾å¯¹åº”çš„ tieEnd
      for (var j = i + 1; j < allNotes.length; j++) {
        final (endMi, endNi, endLayout) = allNotes[j];
        if (endLayout.note.tieEnd && 
            endLayout.note.degree == noteLayout.note.degree &&
            endLayout.note.octave == noteLayout.note.octave) {
          
          connections.add(_createTie(noteLayout, endLayout, mi, ni, endMi, endNi));
          break;
        }
      }
    }
    
    return connections;
  }
  
  static TieConnection _createTie(
    NoteLayout start, NoteLayout end,
    int startMi, int startNi, int endMi, int endNi,
  ) {
    // è¿çº¿åœ¨éŸ³ç¬¦ä¸Šæ–¹æˆ–ä¸‹æ–¹
    final above = !start.stemUp;
    final curveHeight = 15.0;
    
    final startY = above ? start.y - 8 : start.y + 8;
    final endY = above ? end.y - 8 : end.y + 8;
    final midX = (start.x + end.x) / 2;
    final controlY = above ? startY - curveHeight : startY + curveHeight;
    
    return TieConnection(
      startMeasure: startMi,
      startNote: startNi,
      endMeasure: endMi,
      endNote: endNi,
      startPoint: Offset(start.x + 5, startY),
      endPoint: Offset(end.x - 5, endY),
      controlPoint1: Offset(midX - 20, controlY),
      controlPoint2: Offset(midX + 20, controlY),
      isTie: true,
    );
  }
}
```

---

## 5. äº”çº¿è°±æ¸²æŸ“

### 5.1 æ¸²æŸ“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      äº”çº¿è°±æ¸²æŸ“æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚   1. ç»˜åˆ¶å¤´éƒ¨ä¿¡æ¯                                               â”‚
â”‚      â”œâ”€â”€ æ ‡é¢˜ã€ä½œæ›²è€…                                          â”‚
â”‚      â””â”€â”€ è°ƒå·ä¿¡æ¯å¡ç‰‡                                          â”‚
â”‚                                                                â”‚
â”‚   2. é€è¡Œæ¸²æŸ“                                                   â”‚
â”‚      â”œâ”€â”€ ç»˜åˆ¶äº”æ¡è°±çº¿                                          â”‚
â”‚      â”œâ”€â”€ ç»˜åˆ¶è°±å· (é¦–è¡Œ)                                       â”‚
â”‚      â”œâ”€â”€ ç»˜åˆ¶è°ƒå· (å‡é™å·)                                     â”‚
â”‚      â”œâ”€â”€ ç»˜åˆ¶æ‹å· (é¦–è¡Œ)                                       â”‚
â”‚      â”‚                                                         â”‚
â”‚      â””â”€â”€ é€å°èŠ‚æ¸²æŸ“                                            â”‚
â”‚           â”œâ”€â”€ ç»˜åˆ¶ç¬¦æ ç»„ (å…ˆç”»ï¼Œåœ¨éŸ³ç¬¦ä¸‹å±‚)                      â”‚
â”‚           â”œâ”€â”€ ç»˜åˆ¶éŸ³ç¬¦                                         â”‚
â”‚           â”‚    â”œâ”€â”€ åŠ çº¿ (å¦‚éœ€)                                 â”‚
â”‚           â”‚    â”œâ”€â”€ å˜éŸ³è®°å·                                    â”‚
â”‚           â”‚    â”œâ”€â”€ éŸ³ç¬¦å¤´                                      â”‚
â”‚           â”‚    â”œâ”€â”€ é™„ç‚¹                                        â”‚
â”‚           â”‚    â”œâ”€â”€ ç¬¦å¹² (éç¬¦æ ç»„å†…)                           â”‚
â”‚           â”‚    â””â”€â”€ ç¬¦å°¾ (éç¬¦æ ç»„å†…)                           â”‚
â”‚           â”œâ”€â”€ ç»˜åˆ¶æ­Œè¯                                         â”‚
â”‚           â””â”€â”€ ç»˜åˆ¶å°èŠ‚çº¿                                       â”‚
â”‚                                                                â”‚
â”‚   3. ç»˜åˆ¶è¿éŸ³çº¿ (æœ€åï¼Œåœ¨æœ€ä¸Šå±‚)                                 â”‚
â”‚                                                                â”‚
â”‚   4. ç»˜åˆ¶ç»ˆæ­¢çº¿                                                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒç»˜åˆ¶ä»£ç 

```dart
class StaffPainter extends CustomPainter {
  final SheetModel sheet;
  final LayoutResult layout;
  final StaffConfig config;
  final int? highlightMeasure;
  final int? highlightNote;
  
  @override
  void paint(Canvas canvas, Size size) {
    // 1. ç»˜åˆ¶å¤´éƒ¨
    _drawHeader(canvas);
    
    // 2. ç»˜åˆ¶æ¯ä¸€è¡Œ
    for (final line in layout.lines) {
      _drawStaffLine(canvas, line);
    }
    
    // 3. ç»˜åˆ¶è¿éŸ³çº¿ï¼ˆæœ€ä¸Šå±‚ï¼‰
    _drawTieConnections(canvas);
  }
  
  void _drawStaffLine(Canvas canvas, LineLayout line) {
    final startY = line.startY;
    
    // ç»˜åˆ¶äº”æ¡çº¿
    for (var i = 0; i < 5; i++) {
      final y = startY + i * config.lineSpacing;
      canvas.drawLine(
        Offset(config.marginLeft, y),
        Offset(size.width - config.marginRight, y),
        _linePaint,
      );
    }
    
    // ç»˜åˆ¶è°±å·ã€è°ƒå·ã€æ‹å·
    var currentX = config.marginLeft;
    if (line.showClef) {
      currentX = _drawClef(canvas, currentX, startY);
    }
    if (line.showKeySignature) {
      currentX = _drawKeySignature(canvas, currentX, startY);
    }
    if (line.showTimeSignature) {
      currentX = _drawTimeSignature(canvas, currentX, startY);
    }
    
    // ç»˜åˆ¶å°èŠ‚
    for (final measure in line.measures) {
      _drawMeasure(canvas, measure, startY);
    }
  }
  
  void _drawMeasure(Canvas canvas, MeasureLayout measure, double staffY) {
    // å…ˆç»˜åˆ¶ç¬¦æ ï¼ˆåœ¨éŸ³ç¬¦ä¸‹å±‚ï¼‰
    for (final beam in measure.beamGroups) {
      _drawBeamGroup(canvas, measure, beam);
    }
    
    // ç»˜åˆ¶éŸ³ç¬¦
    for (final note in measure.notes) {
      _drawNote(canvas, note, staffY);
    }
    
    // ç»˜åˆ¶å°èŠ‚çº¿
    _drawBarLine(canvas, measure.startX + measure.width, staffY);
  }
  
  /// ç»˜åˆ¶ç¬¦æ ç»„
  void _drawBeamGroup(Canvas canvas, MeasureLayout measure, BeamGroup beam) {
    if (beam.noteIndices.length < 2) return;
    
    final notes = beam.noteIndices.map((i) => measure.notes[i]).toList();
    
    // è®¡ç®—ç¬¦æ æ–œç‡ï¼ˆé™åˆ¶æœ€å¤§æ–œç‡é¿å…è¿‡æ–œï¼‰
    final slope = (beam.endY - beam.startY) / (beam.endX - beam.startX);
    final clampedSlope = slope.clamp(-0.5, 0.5);
    final adjustedEndY = beam.startY + clampedSlope * (beam.endX - beam.startX);
    
    // ç»˜åˆ¶ç¬¦æ ï¼ˆå¯èƒ½å¤šå±‚ï¼‰
    for (var level = 0; level < beam.beamCount; level++) {
      final offset = beam.stemUp ? level * 6.0 : -level * 6.0;
      
      canvas.drawLine(
        Offset(beam.startX, beam.startY + offset),
        Offset(beam.endX, adjustedEndY + offset),
        _beamPaint,
      );
    }
    
    // ç»˜åˆ¶ç¬¦å¹²ï¼ˆè¿æ¥åˆ°ç¬¦æ ï¼‰
    for (var i = 0; i < notes.length; i++) {
      final note = notes[i];
      final t = (note.x - beam.startX) / (beam.endX - beam.startX);
      final beamY = beam.startY + t * (adjustedEndY - beam.startY);
      
      final stemX = beam.stemUp ? note.x + _noteRadius : note.x - _noteRadius;
      canvas.drawLine(
        Offset(stemX, note.y),
        Offset(stemX, beamY),
        _stemPaint,
      );
    }
  }
  
  /// ç»˜åˆ¶è¿éŸ³çº¿
  void _drawTieConnections(Canvas canvas) {
    for (final tie in layout.ties) {
      final path = Path()
        ..moveTo(tie.startPoint.dx, tie.startPoint.dy)
        ..cubicTo(
          tie.controlPoint1.dx, tie.controlPoint1.dy,
          tie.controlPoint2.dx, tie.controlPoint2.dy,
          tie.endPoint.dx, tie.endPoint.dy,
        );
      
      canvas.drawPath(path, _tiePaint);
    }
  }
}
```

### 5.3 éŸ³ç¬¦ç»˜åˆ¶ç»†èŠ‚

```dart
void _drawNote(Canvas canvas, NoteLayout noteLayout, double staffY) {
  final note = noteLayout.note;
  final x = noteLayout.x;
  final y = noteLayout.y;
  final isHighlighted = _isHighlighted(noteLayout);
  final color = isHighlighted ? config.highlightColor : config.noteColor;
  
  // ä¼‘æ­¢ç¬¦ç‰¹æ®Šå¤„ç†
  if (note.isRest) {
    _drawRest(canvas, note, x, staffY, color);
    return;
  }
  
  // 1. ç»˜åˆ¶åŠ çº¿
  _drawLedgerLines(canvas, x, noteLayout.staffPosition, staffY);
  
  // 2. ç»˜åˆ¶å˜éŸ³è®°å·
  if (note.accidental != Accidental.none) {
    _drawAccidental(canvas, x - 15, y, note.accidental, color);
  }
  
  // 3. ç»˜åˆ¶éŸ³ç¬¦å¤´
  _drawNoteHead(canvas, x, y, note.duration, color);
  
  // 4. ç»˜åˆ¶é™„ç‚¹
  if (note.isDotted) {
    canvas.drawCircle(
      Offset(x + _noteRadius * 1.8, y),
      2.5,
      Paint()..color = color,
    );
  }
  
  // 5. ç¬¦å¹²å’Œç¬¦å°¾ï¼ˆä»…å½“ä¸åœ¨ç¬¦æ ç»„å†…ï¼‰
  if (noteLayout.beamGroupIndex < 0 && note.duration != NoteDuration.whole) {
    _drawStemAndFlags(canvas, x, y, noteLayout.stemUp, note.duration, color);
  }
  
  // 6. æ­Œè¯
  if (config.showLyrics && note.lyric != null) {
    _drawLyric(canvas, x, staffY + config.lineSpacing * 5, note.lyric!);
  }
}

/// ç»˜åˆ¶éŸ³ç¬¦å¤´ï¼ˆæ¤­åœ†å½¢ï¼Œç•¥å¾®å€¾æ–œï¼‰
void _drawNoteHead(Canvas canvas, double x, double y, NoteDuration duration, Color color) {
  final paint = Paint()..color = color;
  
  // å…¨éŸ³ç¬¦å’ŒäºŒåˆ†éŸ³ç¬¦æ˜¯ç©ºå¿ƒ
  if (duration == NoteDuration.whole || duration == NoteDuration.half) {
    paint.style = PaintingStyle.stroke;
    paint.strokeWidth = 2;
  } else {
    paint.style = PaintingStyle.fill;
  }
  
  // æ—‹è½¬ç»˜åˆ¶æ¤­åœ†
  canvas.save();
  canvas.translate(x, y);
  canvas.rotate(-0.3); // ç•¥å¾®å€¾æ–œ
  canvas.drawOval(
    Rect.fromCenter(
      center: Offset.zero,
      width: _noteRadius * 2.2,
      height: _noteRadius * 1.6,
    ),
    paint,
  );
  canvas.restore();
}
```

---

## 6. ç®€è°±æ¸²æŸ“

### 6.1 ç®€è°±å…ƒç´ ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç®€è°±éŸ³ç¬¦ç»“æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚                    Â·  â† é«˜éŸ³ç‚¹ï¼ˆå¯å¤šä¸ªï¼‰                      â”‚
â”‚                    Â·                                        â”‚
â”‚                                                             â”‚
â”‚              â™¯ 5 Â· -  â† å˜éŸ³è®°å· + æ•°å­— + é™„ç‚¹ + å»¶éŸ³çº¿      â”‚
â”‚                â€¾â€¾â€¾    â† ä¸‹åˆ’çº¿ï¼ˆå…«åˆ†éŸ³ç¬¦åŠä»¥ä¸‹ï¼‰              â”‚
â”‚                â€¾â€¾â€¾    â† åŒä¸‹åˆ’çº¿ï¼ˆåå…­åˆ†éŸ³ç¬¦ï¼‰               â”‚
â”‚                                                             â”‚
â”‚                    Â·  â† ä½éŸ³ç‚¹ï¼ˆå¯å¤šä¸ªï¼‰                      â”‚
â”‚                    Â·                                        â”‚
â”‚                                                             â”‚
â”‚                   ç¥  â† æ­Œè¯                                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®å¯¹é½åŸåˆ™ï¼š
â”œâ”€â”€ é«˜éŸ³ç‚¹ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ä½éŸ³ç‚¹ å¿…é¡»å‚ç›´å±…ä¸­å¯¹é½
â”œâ”€â”€ å»¶éŸ³çº¿åœ¨æ•°å­—å³ä¾§ï¼Œä¸å½±å“éŸ³ç‚¹å¯¹é½
â””â”€â”€ æ­Œè¯ä¸æ•°å­—ä¸­å¿ƒå¯¹é½
```

### 6.2 æ¸²æŸ“æµç¨‹

```dart
class JianpuPainter extends CustomPainter {
  
  @override
  void paint(Canvas canvas, Size size) {
    // 1. ç»˜åˆ¶å¤´éƒ¨
    _drawHeader(canvas);
    
    // 2. é€è¡Œç»˜åˆ¶
    for (final line in layout.lines) {
      // å°èŠ‚å·
      _drawMeasureNumber(canvas, line);
      
      // å°èŠ‚å†…å®¹
      for (final measure in line.measures) {
        _drawMeasure(canvas, measure, line.startY);
      }
    }
  }
  
  void _drawNote(Canvas canvas, NoteLayout noteLayout, double baseY) {
    final note = noteLayout.note;
    final color = _isHighlighted(noteLayout) ? config.highlightColor : config.noteColor;
    
    // å…ˆè®¡ç®—æ•°å­—ä¸­å¿ƒä½ç½®ï¼ˆæ‰€æœ‰å…ƒç´ ä»¥æ­¤ä¸ºåŸºå‡†ï¼‰
    final numberCenterX = _calculateNumberCenterX(noteLayout);
    
    var y = baseY;
    
    // ========== 1. é«˜éŸ³ç‚¹ï¼ˆåœ¨æœ€ä¸Šæ–¹ï¼‰==========
    if (note.octave > 0) {
      y = _drawOctaveDots(canvas, numberCenterX, y, note.octave, color, isHigh: true);
    }
    
    // ========== 2. æ•°å­—è¡Œ ==========
    final numberY = y;
    var numberX = noteLayout.x;
    
    // 2.1 å˜éŸ³è®°å·
    if (note.accidental != Accidental.none) {
      numberX = _drawAccidental(canvas, numberX, numberY, note.accidental, color);
    }
    
    // 2.2 æ•°å­—
    final numberWidth = _drawNumber(canvas, numberX, numberY, note, color);
    final numberEndX = numberX + numberWidth;
    final actualCenterX = numberX + numberWidth / 2;
    
    // 2.3 é™„ç‚¹ï¼ˆæ•°å­—å³ä¸Šæ–¹ï¼‰
    if (note.isDotted) {
      canvas.drawCircle(
        Offset(numberEndX + 4, numberY + 6),
        3,
        Paint()..color = color,
      );
    }
    
    // 2.4 å»¶éŸ³çº¿ï¼ˆæ•°å­—å³ä¾§ï¼Œç‹¬ç«‹äºéŸ³ç¬¦ä¸»ä½“ï¼‰
    if (note.duration.dashCount > 0) {
      _drawDashLines(canvas, numberEndX + 8, numberY + config.noteFontSize / 2, 
                     note.duration.dashCount, color);
    }
    
    y = numberY + config.noteFontSize;
    
    // ========== 3. ä¸‹åˆ’çº¿ï¼ˆå…«åˆ†åŠä»¥ä¸‹ï¼‰==========
    if (note.duration.underlineCount > 0) {
      y = _drawUnderlines(canvas, actualCenterX, y, note.duration.underlineCount, color);
    }
    
    // ========== 4. ä½éŸ³ç‚¹ ==========
    if (note.octave < 0) {
      y = _drawOctaveDots(canvas, actualCenterX, y + 4, -note.octave, color, isHigh: false);
    }
    
    // ========== 5. æ­Œè¯ ==========
    if (config.showLyrics && note.lyric != null) {
      _drawLyric(canvas, actualCenterX, y + 8, note.lyric!, color);
    }
  }
  
  /// ç»˜åˆ¶é«˜/ä½éŸ³ç‚¹
  double _drawOctaveDots(
    Canvas canvas, double centerX, double y, int count, Color color, {required bool isHigh}
  ) {
    final dotRadius = 2.5;
    final dotSpacing = 6.0;
    
    // è®¡ç®—å¤šç‚¹æ€»å®½åº¦ï¼Œå±…ä¸­æ’åˆ—
    final totalWidth = count * dotRadius * 2 + (count - 1) * (dotSpacing - dotRadius * 2);
    var x = centerX - totalWidth / 2 + dotRadius;
    
    for (var i = 0; i < count; i++) {
      canvas.drawCircle(Offset(x, y), dotRadius, Paint()..color = color);
      x += dotSpacing;
    }
    
    return y + (isHigh ? 10 : 8);
  }
  
  /// ç»˜åˆ¶ä¸‹åˆ’çº¿
  double _drawUnderlines(Canvas canvas, double centerX, double y, int count, Color color) {
    final lineWidth = config.noteFontSize * 0.7;
    final paint = Paint()
      ..color = color
      ..strokeWidth = 2;
    
    for (var i = 0; i < count; i++) {
      y += 4;
      canvas.drawLine(
        Offset(centerX - lineWidth / 2, y),
        Offset(centerX + lineWidth / 2, y),
        paint,
      );
    }
    
    return y;
  }
  
  /// ç»˜åˆ¶å»¶éŸ³çº¿
  void _drawDashLines(Canvas canvas, double startX, double y, int count, Color color) {
    final paint = Paint()
      ..color = color
      ..strokeWidth = 2;
    
    var x = startX;
    for (var i = 0; i < count; i++) {
      canvas.drawLine(Offset(x, y), Offset(x + 12, y), paint);
      x += 16;
    }
  }
}
```

### 6.3 ç®€è°±å®½åº¦è®¡ç®—

```dart
/// è®¡ç®—éŸ³ç¬¦å®½åº¦
double _calculateNoteWidth(SheetNote note) {
  var width = config.noteFontSize + 8; // åŸºç¡€æ•°å­—å®½åº¦
  
  // å˜éŸ³è®°å·
  if (note.accidental != Accidental.none) {
    width += 12;
  }
  
  // é™„ç‚¹
  if (note.isDotted) {
    width += 10;
  }
  
  // å»¶éŸ³çº¿ï¼ˆæ¯æ¡16pxï¼‰
  width += note.duration.dashCount * 16;
  
  return width;
}
```

---

## 7. åŒè°±è”åŠ¨

### 7.1 åŒè°±å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åŒè°±æ˜¾ç¤ºæ¨¡å¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      äº”çº¿è°±                            â”‚  â”‚
â”‚  â”‚  ğ„  â™©  â™©  â™©  â™©  |  â™©  â™©  â™©  â™©  |                     â”‚  â”‚
â”‚  â”‚     ç¥ ä½  ç”Ÿ æ—¥    å¿« ä¹                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†• åŒæ­¥                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      ç®€è°±                              â”‚  â”‚
â”‚  â”‚  5  5  6  5  |  1'  7  |                              â”‚  â”‚
â”‚  â”‚  ç¥ ä½  ç”Ÿ æ—¥    å¿«  ä¹                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å®ç°æ–¹æ¡ˆ

```dart
class DualNotationPainter extends CustomPainter {
  final SheetModel sheet;
  final double width;
  final DualNotationConfig config;
  
  late final StaffPainter _staffPainter;
  late final JianpuPainter _jianpuPainter;
  late final double _staffHeight;
  late final double _jianpuHeight;
  
  DualNotationPainter({
    required this.sheet,
    required this.width,
    required this.config,
  }) {
    // åˆ›å»ºä¸¤ä¸ªå­æ¸²æŸ“å™¨ï¼Œå…±äº«ç›¸åŒçš„å¸ƒå±€å‚æ•°
    _staffPainter = StaffPainter(sheet: sheet, width: width);
    _jianpuPainter = JianpuPainter(sheet: sheet, width: width);
    
    _staffHeight = _staffPainter.totalHeight;
    _jianpuHeight = _jianpuPainter.totalHeight;
  }
  
  double get totalHeight => _staffHeight + _jianpuHeight + 20;
  
  @override
  void paint(Canvas canvas, Size size) {
    // ç»˜åˆ¶äº”çº¿è°±
    _staffPainter.paint(canvas, Size(width, _staffHeight));
    
    // é—´éš”
    canvas.translate(0, _staffHeight + 20);
    
    // ç»˜åˆ¶ç®€è°±
    _jianpuPainter.paint(canvas, Size(width, _jianpuHeight));
  }
}
```

---

## 8. äº¤äº’ç³»ç»Ÿ

### 8.1 äº¤äº’å±‚è®¾è®¡

```dart
class InteractiveSheetWidget extends StatefulWidget {
  final SheetModel sheet;
  final NotationType notationType;
  final void Function(int measureIndex, int noteIndex)? onNoteTap;
  final void Function(int measureIndex, int noteIndex)? onNoteLongPress;
  
  @override
  _InteractiveSheetWidgetState createState() => _InteractiveSheetWidgetState();
}

class _InteractiveSheetWidgetState extends State<InteractiveSheetWidget> {
  late final BaseNotationPainter _painter;
  
  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTapDown: _handleTapDown,
      onLongPressStart: _handleLongPress,
      child: RepaintBoundary(
        child: CustomPaint(
          painter: _painter,
          size: Size(double.infinity, _painter.totalHeight),
        ),
      ),
    );
  }
  
  void _handleTapDown(TapDownDetails details) {
    final hit = _painter.hitTest(details.localPosition);
    if (hit != null) {
      widget.onNoteTap?.call(hit.$1, hit.$2);
    }
  }
}
```

### 8.2 ç‚¹å‡»æ£€æµ‹

```dart
/// åœ¨ Painter ä¸­å®ç°ç‚¹å‡»æ£€æµ‹
(int, int)? hitTest(Offset position) {
  for (final line in _layout.lines) {
    // å¿«é€Ÿæ’é™¤ä¸åœ¨è¯¥è¡Œçš„ç‚¹å‡»
    if (position.dy < line.startY || position.dy > line.startY + line.height) {
      continue;
    }
    
    for (final measure in line.measures) {
      for (final note in measure.notes) {
        if (note.hitBox.contains(position)) {
          return (note.measureIndex, note.noteIndex);
        }
      }
    }
  }
  return null;
}
```

### 8.3 æ’­æ”¾åŒæ­¥é«˜äº®

```dart
class SheetPlayerSyncWidget extends StatelessWidget {
  final SheetPlayerController controller;
  
  @override
  Widget build(BuildContext context) {
    return Obx(() {
      final state = controller.playbackState.value;
      
      return InteractiveSheetWidget(
        sheet: controller.currentSheet.value!,
        highlightMeasureIndex: state.currentMeasureIndex,
        highlightNoteIndex: state.currentNoteIndex,
        onNoteTap: (mi, ni) => controller.seekTo(mi, ni),
      );
    });
  }
}
```

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 åˆ†å±‚æ¸²æŸ“

```dart
/// å°†é™æ€å†…å®¹å’ŒåŠ¨æ€å†…å®¹åˆ†ç¦»
class OptimizedSheetWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Stack(
      children: [
        // é™æ€å±‚ï¼šäº”çº¿è°±çº¿æ¡ã€è°±å·ã€è°ƒå·ï¼ˆå¾ˆå°‘å˜åŒ–ï¼‰
        RepaintBoundary(
          child: CustomPaint(painter: _staticPainter),
        ),
        
        // åŠ¨æ€å±‚ï¼šéŸ³ç¬¦ã€é«˜äº®ï¼ˆé¢‘ç¹é‡ç»˜ï¼‰
        RepaintBoundary(
          child: Obx(() => CustomPaint(
            painter: _dynamicPainter,
          )),
        ),
        
        // äº¤äº’å±‚ï¼šè¦†ç›–åœ¨æœ€ä¸Šå±‚
        GestureDetector(...),
      ],
    );
  }
}
```

### 9.2 å¸ƒå±€ç¼“å­˜

```dart
class CachedLayoutPainter extends CustomPainter {
  LayoutResult? _cachedLayout;
  SheetModel? _cachedSheet;
  double? _cachedWidth;
  
  @override
  void paint(Canvas canvas, Size size) {
    // ä»…åœ¨æ•°æ®å˜åŒ–æ—¶é‡æ–°è®¡ç®—å¸ƒå±€
    if (_cachedSheet != sheet || _cachedWidth != size.width) {
      _cachedLayout = NotationLayoutEngine.calculate(
        sheet: sheet,
        availableWidth: size.width,
        config: config,
      );
      _cachedSheet = sheet;
      _cachedWidth = size.width;
    }
    
    _paintWithLayout(canvas, _cachedLayout!);
  }
}
```

### 9.3 è§†å£è£å‰ª

```dart
/// åªç»˜åˆ¶å¯è§åŒºåŸŸï¼ˆç”¨äºé•¿ä¹è°±æ»šåŠ¨ï¼‰
@override
void paint(Canvas canvas, Size size) {
  final visibleRect = Rect.fromLTWH(0, scrollOffset, size.width, viewportHeight);
  
  for (final line in layout.lines) {
    // è·³è¿‡ä¸å¯è§çš„è¡Œ
    if (line.startY + line.height < visibleRect.top) continue;
    if (line.startY > visibleRect.bottom) break;
    
    _drawLine(canvas, line);
  }
}
```

---

## 10. å®æ–½è®¡åˆ’

### 10.1 é˜¶æ®µåˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®æ–½é˜¶æ®µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ï¼ˆ2å¤©ï¼‰                                        â”‚
â”‚  â”œâ”€â”€ [1] åˆ›å»ºç›®å½•ç»“æ„å’ŒåŸºç¡€ç±»                                    â”‚
â”‚  â”œâ”€â”€ [2] å®ç°å¸ƒå±€æ•°æ®ç»“æ„                                        â”‚
â”‚  â””â”€â”€ [3] å®ç°åŸºç¡€ Painter æ¡†æ¶                                   â”‚
â”‚                                                                 â”‚
â”‚  ç¬¬äºŒé˜¶æ®µï¼šç®€è°±é‡æ„ï¼ˆ2å¤©ï¼‰                                        â”‚
â”‚  â”œâ”€â”€ [4] å®ç° JianpuPainter                                     â”‚
â”‚  â”œâ”€â”€ [5] ç®€è°±å¸ƒå±€å¼•æ“                                           â”‚
â”‚  â””â”€â”€ [6] æµ‹è¯•å’Œè°ƒä¼˜                                             â”‚
â”‚                                                                 â”‚
â”‚  ç¬¬ä¸‰é˜¶æ®µï¼šäº”çº¿è°±å®Œå–„ï¼ˆ2å¤©ï¼‰                                      â”‚
â”‚  â”œâ”€â”€ [7] ç¬¦æ åˆ†ç»„ç®—æ³•                                           â”‚
â”‚  â”œâ”€â”€ [8] è¿éŸ³çº¿è®¡ç®—å’Œç»˜åˆ¶                                        â”‚
â”‚  â””â”€â”€ [9] ä¼˜åŒ–éŸ³ç¬¦ç»˜åˆ¶                                           â”‚
â”‚                                                                 â”‚
â”‚  ç¬¬å››é˜¶æ®µï¼šåŒè°±å’Œäº¤äº’ï¼ˆ1å¤©ï¼‰                                      â”‚
â”‚  â”œâ”€â”€ [10] åŒè°±æ¸²æŸ“å™¨                                            â”‚
â”‚  â”œâ”€â”€ [11] äº¤äº’å±‚å®ç°                                            â”‚
â”‚  â””â”€â”€ [12] æ’­æ”¾åŒæ­¥                                              â”‚
â”‚                                                                 â”‚
â”‚  ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å¤©ï¼‰                                      â”‚
â”‚  â”œâ”€â”€ [13] æ€§èƒ½ä¼˜åŒ–                                              â”‚
â”‚  â”œâ”€â”€ [14] SMuFL å­—ä½“é›†æˆï¼ˆå¯é€‰ï¼‰                                 â”‚
â”‚  â””â”€â”€ [15] å…¨é¢æµ‹è¯•                                              â”‚
â”‚                                                                 â”‚
â”‚  é¢„è®¡æ€»å·¥æœŸï¼š7-8 ä¸ªå·¥ä½œæ—¥                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 éªŒæ”¶æ ‡å‡†

| åŠŸèƒ½ç‚¹ | éªŒæ”¶æ ‡å‡† |
|--------|---------|
| ç®€è°±æ¸²æŸ“ | é«˜ä½éŸ³ç‚¹ä¸æ•°å­—å±…ä¸­å¯¹é½ï¼Œå»¶éŸ³çº¿ä¸å½±å“å¯¹é½ |
| äº”çº¿è°±ç¬¦æ  | åŒç»„å…«åˆ†éŸ³ç¬¦æ­£ç¡®è¿æ¥ï¼Œç¬¦æ æ–œç‡åˆç† |
| è¿éŸ³çº¿ | å¹³æ»‘çš„è´å¡å°”æ›²çº¿ï¼Œæ­£ç¡®è¿æ¥é¦–å°¾éŸ³ç¬¦ |
| åŒè°±æ¨¡å¼ | äº”çº¿è°±å’Œç®€è°±å°èŠ‚å¯¹é½ï¼ŒåŒæ­¥é«˜äº® |
| ç‚¹å‡»äº¤äº’ | ç‚¹å‡»éŸ³ç¬¦å‡†ç¡®å“åº”ï¼Œé«˜äº®æ˜¾ç¤ºæ­£ç¡® |
| æ’­æ”¾åŒæ­¥ | è¿›åº¦æ¡ä¸éŸ³ç¬¦é«˜äº®å®Œå…¨åŒæ­¥ |
| æ€§èƒ½ | 100å°èŠ‚ä¹è°±æ»šåŠ¨æµç•…ï¼Œæ— å¡é¡¿ |

### 10.3 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|------|---------|
| SMuFL å­—ä½“æ˜¾ç¤ºå¼‚å¸¸ | ä¸­ | ä¸­ | å‡†å¤‡çº¯è‡ªç»˜å¤‡é€‰æ–¹æ¡ˆ |
| ç¬¦æ ç®—æ³•å¤æ‚åº¦é«˜ | ä½ | ä¸­ | åˆ†æ­¥å®ç°ï¼Œå…ˆæ”¯æŒç®€å•æƒ…å†µ |
| è·¨è¡Œè¿éŸ³çº¿è®¡ç®—å›°éš¾ | ä¸­ | ä½ | é™åˆ¶ä¸ºåŒè¡Œå†…è¿æ¥ |
| Web ç«¯æ€§èƒ½é—®é¢˜ | ä¸­ | ä¸­ | å¯ç”¨ CanvasKit æ¸²æŸ“å™¨ |

---

## é™„å½•

### A. SMuFL ç¬¦å·ç ç‚¹è¡¨

| ç¬¦å· | Unicode | ç”¨é€” |
|------|---------|------|
| U+E050 | gClef | é«˜éŸ³è°±å· |
| U+E062 | fClef | ä½éŸ³è°±å· |
| U+E0A0 | noteheadWhole | å…¨éŸ³ç¬¦å¤´ |
| U+E0A2 | noteheadHalf | äºŒåˆ†éŸ³ç¬¦å¤´ |
| U+E0A4 | noteheadBlack | å››åˆ†åŠä»¥ä¸‹éŸ³ç¬¦å¤´ |
| U+E240 | flag8thUp | å…«åˆ†éŸ³ç¬¦ç¬¦å°¾ï¼ˆå‘ä¸Šï¼‰ |
| U+E241 | flag8thDown | å…«åˆ†éŸ³ç¬¦ç¬¦å°¾ï¼ˆå‘ä¸‹ï¼‰ |
| U+E262 | accidentalSharp | å‡å· |
| U+E260 | accidentalFlat | é™å· |
| U+E261 | accidentalNatural | è¿˜åŸå· |
| U+E4E0 | restWhole | å…¨ä¼‘æ­¢ç¬¦ |
| U+E4E1 | restHalf | äºŒåˆ†ä¼‘æ­¢ç¬¦ |
| U+E4E5 | restQuarter | å››åˆ†ä¼‘æ­¢ç¬¦ |
| U+E4E6 | rest8th | å…«åˆ†ä¼‘æ­¢ç¬¦ |

### B. å‚è€ƒèµ„æ–™

- [SMuFL å®˜æ–¹è§„èŒƒ](https://www.w3.org/2019/03/smufl13/)
- [Bravura å­—ä½“ä¸‹è½½](https://github.com/steinbergmedia/bravura)
- [MusicXML è§„èŒƒ](https://www.musicxml.com/)
- [VexFlow æºç ](https://github.com/0xfe/vexflow)
- [MuseScore æºç ](https://github.com/musescore/MuseScore)

### C. æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| v2.0 | 2026-01-13 | å®Œæ•´è®¾è®¡æ–‡æ¡£ï¼ŒCanvas ç»Ÿä¸€æ–¹æ¡ˆ |
| v1.0 | - | åˆå§‹ Widget æ‹¼æ¥æ–¹æ¡ˆï¼ˆå·²åºŸå¼ƒï¼‰ |

---

> ğŸ“ **æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£éšå¼€å‘è¿›åº¦æŒç»­æ›´æ–°ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

